<div class="artwork">
  <img class="container-image" src="<%=
    artwork = @story.artwork_url
    if artwork == nil
      artwork = @story.user.avatar_url
    end 
    artwork.sub! "large", "crop"
     %>">
 <!--  <div class="forward">
     <span class="glyphicon glyphicon-forward"></span>
  </div> -->
  <div class="play-button">
     <span class="glyphicon glyphicon-play-circle"></span>
  </div>  
  <!-- <div class="rewind">
     <span class="glyphicons glyphicons-rewind"</span>
  </div> -->
</div>
</br>
</br>
<div class="story-place">@SoundCloud HQ</div>

<%= render partial: "create_comments" %>

<script>
  var story; 
  var playPauseButton = $('.play-button');
  var state = {
      isPlaying: false,
      isBuffering : false
  };
  var options = {
    onfinish : function(){
      playPauseButton.html('<span class="glyphicon glyphicon-play-circle"></span>');
    }
  }

  SC.initialize({
    client_id: '69e93cf2209402f6f3137a6452cf498f'
  });
  //setup on click
  playPauseButton.on('click', function(event) {
    if (story) {
      if (state.isPlaying) {
        story.pause();
        playPauseButton.html('<span class="glyphicon glyphicon-play-circle"></span>');
        state.isPlaying = false;
      } else {
        story.play();
        playPauseButton.html('<span class="glyphicon glyphicon-pause"></span>');
        state.isPlaying = true;
      }
    }else{
      if (state.isBuffering) {
        playPauseButton.html('<span class="glyphicon glyphicon-play-circle"></span>');
        state.isBuffering = false;
      } else{
        playPauseButton.html('<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>');
        state.isBuffering = true;
      }
    }
  });
  //Fetch stream 
  setTimeout( function (){
    SC.stream(<%= @story.id %>, options ,function(sound){
      //if we comment this line we can test the else ( if story is not true)
      story = sound;
      console.log("story ready");
      if (state.isBuffering) {
        story.play();
        playPauseButton.html('<span class="glyphicon glyphicon-pause"></span>');
        state.isPlaying = true;
        state.isBuffering = false;
      }
    });
  }, 3000);
</script>
